<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>üåæ HarvestGuard - Image Scan Portal</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: #f9f9f9;
        margin: 0;
        padding: 0;
        color: #333;
      }

      header {
        background-color: #3c763d;
        color: white;
        padding: 20px;
        text-align: center;
        font-size: 1.5em;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      }

      main {
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      h2 {
        margin-bottom: 10px;
      }

      input[type="file"] {
        padding: 10px;
        margin-bottom: 20px;
      }

      button {
        background-color: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        font-size: 1em;
        cursor: pointer;
      }

      button:hover {
        background-color: #45a049;
      }

      .results {
        margin-top: 30px;
      }

      .result-entry {
        padding: 10px;
        margin-bottom: 10px;
        border-left: 6px solid #ccc;
        background: #f7f7f7;
        border-radius: 4px;
      }

      .flagged {
        border-left-color: #e74c3c;
        background: #fdecea;
      }

      .accepted {
        border-left-color: #2ecc71;
        background: #eafaf1;
      }

      .error {
        border-left-color: #f39c12;
        background: #fff6e5;
      }
    </style>
  </head>
  <body>
    <header>üåæ HarvestGuard - AI Image Scan</header>

    <main>
      <h2>Upload Image or ZIP</h2>
      <input type="file" id="fileInput" multiple />
      <br />
      <button onclick="submitScan()">üîç Scan Now</button>

      <div class="results" id="resultsContainer"></div>
    </main>

    <script>
      async function submitScan() {
        const files = document.getElementById("fileInput").files;
        if (!files.length) {
          alert("Please select at least one image or a ZIP file.");
          return;
        }

        const formData = new FormData();
        for (let file of files) {
          formData.append("files", file);
        }

        document.getElementById(
          "resultsContainer"
        ).innerHTML = `<p>‚è≥ Scanning in progress...</p>`;

        try {
          const response = await fetch(
            "http://127.0.0.1:8000/api/v1/scan/batch",
            {
              method: "POST",
              body: formData,
              headers: {
                Authorization:
                  "Bearer e8c25f837477ae1606f935d11af105f64e6400fb8b181bba04f97640b79afcac731997599e906bcd6ffa23345b23d0cf43ae92e9dde1c8d209f67ee95169cca5",
              },
            }
          );

          if (!response.ok) {
            throw new Error("Server responded with " + response.status);
          }

          const data = await response.json();
          const resultsDiv = document.getElementById("resultsContainer");
          resultsDiv.innerHTML = `<h3>üìä Scan Results:</h3>`;

          data.results.forEach((res) => {
            const div = document.createElement("div");
            const cls =
              res.decision === "ERROR"
                ? "error"
                : res.decision === "FLAGGED"
                ? "flagged"
                : "accepted";
            div.className = `result-entry ${cls}`;
            div.innerHTML = `
          <strong>${res.image}</strong> - ${res.decision}<br>
          üîç Confidence: ${res.confidence}<br>
          üßÆ Reconstruction Error: ${res.reconstruction_error}
        `;
            resultsDiv.appendChild(div);
          });
        } catch (err) {
          document.getElementById(
            "resultsContainer"
          ).innerHTML = `<p class="error">‚ùå Error: ${err.message}</p>`;
        }
      }
    </script>
  </body>
</html>
